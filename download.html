<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Download OtoLog</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@600;800&family=Noto+Sans+JP:wght@500;700&display=swap"
        rel="stylesheet">
    <!-- å…±é€šã‚¹ã‚¿ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ -->
    <link rel="stylesheet" href="style.css">
    <style>
        /* ãƒ­ã‚´ãƒ»ã‚¿ã‚¤ãƒˆãƒ«ã‚¨ãƒªã‚¢ */
        .top-content {
            position: absolute;
            top: 8%;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* å°ã•ã‚ã®ã‚¢ãƒ—ãƒªã‚¢ã‚¤ã‚³ãƒ³ */
        .icon-small {
            width: 70px;
            height: 70px;
            border-radius: 18px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
            object-fit: cover;
        }

        h1 {
            font-size: 24px;
            font-weight: 800;
            margin: 0;
        }

        /* ä¸­å¤®ã«è¡¨ç¤ºã™ã‚‹ã‚«ãƒ¼ãƒ‰ã®ãƒ©ãƒƒãƒ‘ãƒ¼ */
        .card-wrapper {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            max-width: 340px;
            padding: 0 24px;
            box-sizing: border-box;
        }

        /* ã‚°ãƒ«ãƒ¼ãƒ—IDã‚’è¡¨ç¤ºã™ã‚‹ã‚«ãƒ¼ãƒ‰ */
        .id-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        }

        .id-label {
            font-size: 10px;
            font-weight: 700;
            color: #86868b;
            margin-bottom: 8px;
        }

        .id-value {
            font-size: 34px;
            font-weight: 800;
            color: #007AFF;
            margin-bottom: 4px;
            line-height: 1;
        }

        .copy-hint {
            font-size: 11px;
            color: #86868b;
            margin-bottom: 15px;
            display: block;
        }

        /* ã‚¢ãƒ—ãƒªã¸ã®å…¥åŠ›ã‚¬ã‚¤ãƒ‰ã‚¨ãƒªã‚¢ */
        .input-guide {
            border-top: 1px dashed #ddd;
            padding-top: 10px;
            margin-top: 5px;
        }

        .guide-text {
            font-size: 11px;
            color: #333;
            margin-bottom: 5px;
            font-weight: bold;
        }

        /* ã‚¢ãƒ—ãƒªç”»é¢ã®ãƒ¢ãƒƒã‚¯ã‚¢ãƒƒãƒ— */
        .mock-phone {
            width: 140px;
            background: #E0F2F1;
            border-radius: 10px;
            padding: 8px 10px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 5px;
            position: relative;
        }

        .mock-title {
            height: 6px;
            width: 60%;
            background: #00acc1;
            margin: 0 auto 2px;
            border-radius: 4px;
            opacity: 0.5;
        }

        .mock-input {
            height: 14px;
            background: white;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        /* å…¥åŠ›å¯¾è±¡ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ */
        .mock-input.target {
            border: 2px solid #007AFF;
            background: #eef6ff;
        }

        /* å…¥åŠ›å…ˆã‚’æŒ‡ã™ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãçŸ¢å° */
        .pointer {
            position: absolute;
            right: -25px;
            bottom: 10px;
            font-size: 20px;
            animation: point 1s infinite alternate;
        }

        @keyframes point {
            from {
                transform: translateX(0);
            }

            to {
                transform: translateX(-5px);
            }
        }

        /* ãƒãƒƒã‚¸ï¼ˆOSåˆ¶é™è¡¨ç¤ºãªã©ï¼‰ */
        .badge {
            background: #ff3b30;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            color: white;
            margin-left: 6px;
        }

        /* ã‚³ãƒ”ãƒ¼å®Œäº†ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 12px;
            opacity: 0;
            transition: 0.4s;
            pointer-events: none;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* FULLãƒ»ã‚¨ãƒ©ãƒ¼æ™‚ã®IDãƒ†ã‚­ã‚¹ãƒˆè‰² */
        .id-value.error {
            color: #FF3B30;
            font-size: 24px;
        }
    </style>
</head>

<body>

    <div class="top-content">
        <img src="icon.png" class="icon-small" alt="OtoLog ã‚¢ãƒ—ãƒªã‚¢ã‚¤ã‚³ãƒ³">
        <h1>Download</h1>
    </div>

    <div class="card-wrapper">
        <div class="id-card">
            <div class="id-label">Your Group ID</div>
            <div id="groupId" class="id-value" onclick="copyId()">...</div>
            <span class="copy-hint" id="copyHint">ã‚¿ãƒƒãƒ—ã—ã¦ã‚³ãƒ”ãƒ¼</span>

            <div class="input-guide">
                <div class="guide-text">ã‚¢ãƒ—ãƒªã®2æ®µç›®ã«å…¥åŠ›ã—ã¦ãã ã•ã„</div>
                <div class="mock-phone">
                    <div class="mock-title"></div>
                    <div class="mock-input"></div>
                    <div class="mock-input target"></div>
                    <div class="pointer">ğŸ‘ˆ</div>
                </div>
            </div>
        </div>
    </div>

    <div class="bottom-area">
        <a id="downloadBtn" href="https://testflight.apple.com/join/ZnBbsWNj" class="btn btn-primary">
            Download on iOS <span class="badge">26+</span>
        </a>
        <a href="walkthrough.html" class="btn btn-text">
            ä½¿ã„æ–¹ã‚’ã‚‚ã†ä¸€åº¦è¦‹ã‚‹
        </a>
    </div>

    <div id="toast" class="toast">ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ</div>

    <script>
        // â˜…â˜…â˜… GASã®URLã«æ›¸ãæ›ãˆã¦ãã ã•ã„ â˜…â˜…â˜…
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwaRek10Td3Z25Rfr2k6CDZ86sdtC4m5CKbDzr-59SjhJf2rpFOGyjp_Nz4xGA-GeZnPw/exec";

        let currentId = "";

        /**
         * æº€å“¡ã¾ãŸã¯å–å¾—ä¸å¯ã®å ´åˆã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹
         * @param {string} message - ãƒœã‚¿ãƒ³ã«è¡¨ç¤ºã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆ
         */
        function disableDownloadButton(message) {
            const btn = document.getElementById('downloadBtn');
            btn.className = 'btn btn-disabled';
            btn.textContent = message;
            btn.removeAttribute('href');
        }

        /**
         * GASã‹ã‚‰ã‚°ãƒ«ãƒ¼ãƒ—IDã‚’å–å¾—ã—ã¦UIã«åæ˜ ã™ã‚‹
         */
        async function fetchId() {
            const display = document.getElementById('groupId');
            const hint = document.getElementById('copyHint');

            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚ã‚Œã°å†å–å¾—ã—ãªã„
            const saved = localStorage.getItem('otolog_id');
            if (saved) {
                currentId = saved;
                display.innerText = saved;
                return;
            }

            try {
                const res = await fetch(SCRIPT_URL);
                const data = await res.json();

                if (data.group === "FULL") {
                    // æº€å“¡ã®å ´åˆï¼šIDã‚’è¡¨ç¤ºã›ãšãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
                    display.classList.add('error');
                    display.innerText = "æº€å“¡";
                    hint.style.display = 'none';
                    disableDownloadButton("ç¾åœ¨ã¯æº€å“¡ã§ã™");
                } else if (data.group === "ERROR") {
                    // ã‚¨ãƒ©ãƒ¼ã®å ´åˆï¼šå–å¾—å¤±æ•—ã‚’é€šçŸ¥ã—ã¦ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
                    display.classList.add('error');
                    display.innerText = "å–å¾—å¤±æ•—";
                    hint.style.display = 'none';
                    disableDownloadButton("å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„");
                } else {
                    // æ­£å¸¸å–å¾—ï¼šIDã‚’è¡¨ç¤ºã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
                    currentId = data.group;
                    display.innerText = currentId;
                    localStorage.setItem('otolog_id', currentId);
                }
            } catch (e) {
                // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼
                display.classList.add('error');
                display.innerText = "é€šä¿¡ã‚¨ãƒ©ãƒ¼";
                hint.style.display = 'none';
                disableDownloadButton("å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„");
            }
        }

        /**
         * ã‚°ãƒ«ãƒ¼ãƒ—IDã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã€ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã‚’è¡¨ç¤ºã™ã‚‹
         */
        function copyId() {
            if (!currentId) return;
            navigator.clipboard.writeText(currentId).then(() => {
                const t = document.getElementById('toast');
                t.classList.add('show');
                setTimeout(() => t.classList.remove('show'), 2000);
            });
        }

        window.onload = fetchId;
    </script>
</body>

</html>
